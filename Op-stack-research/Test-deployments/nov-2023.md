# Introduction
From October to November 2023, we conducted a comprehensive evaluation of the operational cost performance of the OP stack within a testnet environment, focusing specifically on the gas spending by the batcher and proposer components. This testing phase was strategically scheduled before the Dencun, Ecotone, and Fjord upgrades, ensuring that we were prepared for the advanced features such as span batches, datablobs, and fault proofs that were not yet implemented.

During our 7-day deployment of the OP stack on the Sepolia Testnet, we observed a significant number of transactions generated by the batcher (~27,000) and substantial gas expenditure (~9.5 ETH). This activity occurred despite the absence of additional user or contract interactions, likely due to RPC call limits, which triggered a chain reaction of empty blocks from the sequencer to the batcher. This highlighted the critical need to address scalability issues within the OP stack to efficiently support high throughput and varied user interactions.

# Project Objectives

- [x]  1 Deploy a OP rollup with external mentorship
- [x]  2 Test a OP rollup in a VM for 7 days
- [x]  3 Preliminary Findings

## 1 Deploy a OP rollup with external mentorship

Using a remote SSH node, we deployed a test rollup in the past October during an online course by Optimism en Español and Filosofía Código. This includes:

1. Configuring an alchemy RPC URL to deploy the L1 contracts in Sepolia Network
2. Build the OPstack to deployer L2 contracts
3. Deploy and bridge ERC20 tokens
4. Set up a block explorer for our L2 rollup

[Live Workshop](https://www.youtube.com/watch?v=fQ3tF29gR4w&t=1s)

[Workshop docs](https://github.com/Turupawn/stack-docs/blob/op-pr/src/docs/build/getting-started.md)

The L2 rollup contracts deployed in Sepolia are available here:

1. [Bridge](https://sepolia.etherscan.io/address/0xa4c424c2925f39a3a680d91caaf98dea4db39491)
2. [Admin](https://sepolia.etherscan.io/address/0x7a8c9562526514488875136effd989c794bc58a1)
3. [Proposer](https://sepolia.etherscan.io/address/0xe75a79feb44c0d8e6b1e88c5d7ebab6d07ea512b)
4. [Batcher](https://sepolia.etherscan.io/address/0x1dd9f98d88acb01f0d7f742ac06b4c9094dcd7a4)

# 2 Test a OP rollup in a VM for 7 days

We have use a Virtual Machine in Google Cloud to deploy an OP rollup with the following configuration: 

>Machine type: e2-standard-2
Cores: 2 vCPU
Memory: 8 GB

After connecting to a Sepolia node through Alchemy, installing dependencies, and building the `Optimism Monorepo` and `op-geth`, we created the four accounts that manage the rollup operation:

- The [`Admin`](https://sepolia.etherscan.io/address/0x3c90fda98697e8a8e3a2280e91e37978af6892d5) account can upgrade contracts.
- The [`Batcher`](https://sepolia.etherscan.io/address/0x0baf402794dacb56e5b9d3ae30a269a65e6898ce) account which publishes Sequencer transaction data to L1.
- The [`Proposer`](https://sepolia.etherscan.io/address/0x2deebf69cafeab907d94e6788ffc850090ccb561) account which publishes L2 transaction results to L1.
- The [`Sequencer`](https://sepolia.etherscan.io/address/0x565d75374d2df1e55553ca931f3c0527b2c93868) account signs blocks on the p2p network.

Along with these accounts a [`Bridge`](https://sepolia.etherscan.io/address/0x2139ac2d92de1f4166e9b130a1ac2567dac77132) contract is created in order to transfer funds into the rollup.

![OP stack on Sepolia 7 days](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fb93d7c62-4ce7-46c6-a8c7-8f9ce471d508%2F111df0ce-eecf-4875-a20b-8e22ac941905%2FUntitled.png?table=block&id=3492b6fe-ecb8-43d5-a3ce-ab2af7c16b1a&spaceId=b93d7c62-4ce7-46c6-a8c7-8f9ce471d508&width=2000&userId=9ec5d830-7a6e-4543-99a2-3a110d7fec88&cache=v2)

# Preliminary Findings

While investigating the operation of the OP stack as a potential solution to this issue, we faced multiple limitations relating to the cost of operation of the batcher contract and the constraints of relying on either a RPC-as-a-service or a Rollup-as-a-service platform. We found this issue during a 7-day rollup deployment from the OP stack in the Sepolia Testnet, where the main highlight is the high number of transactions generated by the batcher (~27,000) and gas spent on these (~9.5 ETH). This performance was only for the default rollup activity, without considering any additional user or contract interaction, which may be caused by the limit in RPC calls from the provider (alchemy) that trigger a chain reaction of empty blocks from the sequencer to the batcher, accelerating the transaction and gas fee rate. 

Upon comparing the data with the [OP Sepolia batcher](https://sepolia.etherscan.io/address/0x8F23BB38F531600e5d8FDDaAEC41F13FaB46E98c), there is a significant difference in the number of transactions made during the same dates (~11,000 or 40% from the 7-day reference run) but not so with the higher gas spent (~12 ETH), which makes sense with the use of the testnet by a high volume of actual users and contracts. However, it may not be able to fulfill the Superchain vision of having multiple chains derived from the OP stack that may not have the same user volume or chains with high throughput primarily used for non-DeFi applications and do not rely on sequencer revenue to be profitable.

![Batcher Gas Spending Nov2023](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fb93d7c62-4ce7-46c6-a8c7-8f9ce471d508%2F714b169c-e2b2-46e3-aa18-b4b907d44f02%2FUntitled.png?table=block&id=60ccce5e-d012-43be-83cd-a9d51db22d94&spaceId=b93d7c62-4ce7-46c6-a8c7-8f9ce471d508&width=2000&userId=9ec5d830-7a6e-4543-99a2-3a110d7fec88&cache=v2)